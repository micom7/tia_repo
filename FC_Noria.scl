FUNCTION "FC_Noria" : VOID
{ S7_Optimized_Access := 'TRUE' }
VERSION : 1.0

// ============================================================================
// FC_Noria - Логіка норії (ЗАГЛУШКА)
// ============================================================================
// TODO: Реалізувати повну логіку норії аналогічно FC_Redler
// ============================================================================

VAR_IN_OUT
    N : "UDT_Noria";           // типізована норія (I/O + таймінги)
    B : "UDT_BaseMechanism";   // базовий механізм слоту (Cmd/Status/FLT/Owner...)
END_VAR

VAR_TEMP
    isFault   : BOOL;
    isBlocked : BOOL;
END_VAR

BEGIN
    // =========================================================
    // ЗАГЛУШКА: базова логіка без повної FSM
    // =========================================================
    
    // 1. RESET
    IF B.Cmd = "DB_Const".CMD_RESET THEN
        B.FLTCode := "DB_Const".FLT_NONE;
        B.Status  := "DB_Const".STS_IDLE;
        N.StartMs := 0;
        N.SpeedLostMs := 0;
        B.LastCmd := B.Cmd;
    END_IF;
    
    isFault := (B.Status = "DB_Const".STS_FAULT);
    
    // 2. Enable / LocalManual
    IF NOT B.Enable_OK THEN
        B.Status := "DB_Const".STS_DISABLED;
        B.OwnerCur := 0;
        B.OwnerCurId := 0;
        N.StartMs := 0;
        N.SpeedLostMs := 0;
        
    ELSIF B.LocalManual THEN
        B.Status := "DB_Const".STS_LOCAL;
        B.OwnerCur := 0;
        B.OwnerCurId := 0;
        N.StartMs := 0;
        N.SpeedLostMs := 0;
    END_IF;
    
    isBlocked := (B.Status = "DB_Const".STS_DISABLED) OR (B.Status = "DB_Const".STS_LOCAL);
    
    // 3. Фіксація команди
    IF B.Cmd <> "DB_Const".CMD_NONE THEN
        B.LastCmd := B.Cmd;
    END_IF;
    
    // 4. Місцеві аварії (заглушка: тільки Breaker)
    IF (NOT isFault) AND (NOT isBlocked) THEN
        IF NOT N.DI_Breaker_OK THEN
            B.FLTCode := "DB_Const".FLT_BREAKER;
            B.Status  := "DB_Const".STS_FAULT;
            isFault := TRUE;
        END_IF;
    END_IF;
    
    // 5. Проста FSM (заглушка)
    IF (NOT isFault) AND (NOT isBlocked) THEN
        
        IF B.Cmd = "DB_Const".CMD_START THEN
            IF B.Status = "DB_Const".STS_IDLE THEN
                B.Status := "DB_Const".STS_STARTING;
                N.StartMs := TIME_TCK();
            END_IF;
        END_IF;
        
        IF B.Cmd = "DB_Const".CMD_STOP THEN
            IF (B.Status = "DB_Const".STS_STARTING) OR (B.Status = "DB_Const".STS_RUNNING) THEN
                B.Status := "DB_Const".STS_STOPPING;
            END_IF;
        END_IF;
        
        // Переходи станів (спрощені)
        IF B.Status = "DB_Const".STS_STARTING THEN
            IF N.DI_Speed_OK THEN
                B.Status := "DB_Const".STS_RUNNING;
                N.StartMs := 0;
            END_IF;
        ELSIF B.Status = "DB_Const".STS_STOPPING THEN
            IF NOT N.DI_Speed_OK THEN
                B.Status := "DB_Const".STS_IDLE;
                N.StartMs := 0;
                N.SpeedLostMs := 0;
            END_IF;
        END_IF;
        
    END_IF;
    
    // 6. Формування виходу DO_Run
    IF (B.Status = "DB_Const".STS_STARTING) OR (B.Status = "DB_Const".STS_RUNNING) THEN
        N.DO_Run := TRUE;
    ELSE
        N.DO_Run := FALSE;
    END_IF;
    
END_FUNCTION